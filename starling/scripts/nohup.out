CMake Warning (dev) at CMakeLists.txt:18 (project):
  Policy CMP0048 is not set: project() command manages VERSION variables.
  Run "cmake --help-policy CMP0048" for policy details.  Use the cmake_policy
  command to set the policy and suppress this warning.

  The following variable(s) would be set to empty:

    CMAKE_PROJECT_VERSION
    CMAKE_PROJECT_VERSION_MAJOR
    CMAKE_PROJECT_VERSION_MINOR
    CMAKE_PROJECT_VERSION_PATCH
This warning is for project developers.  Use -Wno-dev to suppress it.

-- IPO enabled
-- The tbbbind_2_0 target will be configured using the HWLOC 2.1.0
-- Configuring done
-- Generating done
-- Build files have been written to: /mnt/data/starling/release
/mnt/data/starling/release /mnt/data/starling/scripts
[  1%] Built target tbbbind_2_0
[  4%] Built target float_bin_to_int8
[  8%] Built target tbbmalloc
[  9%] Built target ivecs_to_bin
[ 10%] Built target bin_to_tsv
[ 11%] Built target fvecs_to_bin
[ 12%] Built target fvecs_to_bvecs
[ 24%] Built target diskann
[ 26%] Built target simulate_aggregate_recall
[ 37%] Built target diskann_s
[ 38%] Built target tsv_to_bin
[ 58%] Built target tbb
[ 60%] Built target gen_random_slice
[ 62%] Built target int8_to_float_scale
[ 64%] Built target uint32_to_uint8
[ 66%] Built target parse_freq_file
[ 68%] Built target tbbmalloc_proxy
[ 69%] Built target sq
[ 71%] Built target uint8_to_float
[ 71%] Built target int8_to_float
[ 74%] Built target partition_data
[ 74%] Built target vector_analysis
[ 75%] Built target compute_groundtruth
[ 76%] Built target rand_data_gen
[ 78%] Built target generate_pq
[ 80%] Built target partition_with_ram_budget
[ 81%] Built target index_relayout
[ 82%] Built target calculate_recall
[ 83%] Built target merge_shards
[ 84%] Built target search_disk_index
[ 86%] Built target search_memory_index
[ 87%] Built target gen_range
[ 89%] Built target build_memory_index
[ 91%] Built target range_search_disk_index
[ 93%] Built target create_disk_layout
[ 94%] Built target build_disk_index
[ 95%] Built target test_streaming_scenario
[ 97%] Built target test_insert_deletes_consolidate
[ 98%] Built target search_memory_index_dynamic
[ 99%] Built target partitioner
[100%] Built target search_disk_index_save_freq
/mnt/data/starling/scripts
Sat 30 Nov 2024 02:34:33 AM CST
Directory gist_1m_M32_R64_L50_B0.3/ is already exit. Remove or rename it and then re-run.
CMake Warning (dev) at CMakeLists.txt:18 (project):
  Policy CMP0048 is not set: project() command manages VERSION variables.
  Run "cmake --help-policy CMP0048" for policy details.  Use the cmake_policy
  command to set the policy and suppress this warning.

  The following variable(s) would be set to empty:

    CMAKE_PROJECT_VERSION
    CMAKE_PROJECT_VERSION_MAJOR
    CMAKE_PROJECT_VERSION_MINOR
    CMAKE_PROJECT_VERSION_PATCH
This warning is for project developers.  Use -Wno-dev to suppress it.

-- IPO enabled
-- The tbbbind_2_0 target will be configured using the HWLOC 2.1.0
-- Configuring done
-- Generating done
-- Build files have been written to: /mnt/data/starling/release
/mnt/data/starling/release /mnt/data/starling/scripts
[  1%] Built target ivecs_to_bin
[  2%] Built target bin_to_tsv
[  4%] Built target float_bin_to_int8
[  5%] Built target tbbbind_2_0
[  6%] Built target tsv_to_bin
[ 11%] Built target tbbmalloc
[ 13%] Built target simulate_aggregate_recall
[ 14%] Built target fvecs_to_bvecs
[ 15%] Built target fvecs_to_bin
[ 26%] Built target diskann_s
[ 38%] Built target diskann
[ 58%] Built target tbb
[ 60%] Built target tbbmalloc_proxy
[ 62%] Built target vector_analysis
[ 64%] Built target gen_random_slice
[ 67%] Built target int8_to_float_scale
[ 67%] Built target partition_data
[ 68%] Built target int8_to_float
[ 70%] Built target uint32_to_uint8
[ 72%] Built target parse_freq_file
[ 73%] Built target uint8_to_float
[ 74%] Built target gen_range
[ 75%] Built target calculate_recall
[ 76%] Built target merge_shards
[ 77%] Built target compute_groundtruth
[ 79%] Built target partition_with_ram_budget
[ 82%] Built target sq
[ 82%] Built target generate_pq
[ 84%] Built target rand_data_gen
[ 86%] Built target create_disk_layout
[ 86%] Built target index_relayout
[ 88%] Built target build_memory_index
[ 90%] Built target search_memory_index
[ 91%] Built target search_disk_index
[ 92%] Built target build_disk_index
[ 94%] Built target range_search_disk_index
[ 95%] Built target test_streaming_scenario
[ 96%] Built target search_memory_index_dynamic
[ 97%] Built target partitioner
[ 98%] Built target search_disk_index_save_freq
[100%] Built target test_insert_deletes_consolidate
/mnt/data/starling/scripts
Sat 30 Nov 2024 10:34:28 AM CST
Partition file not found. Run the script with gp option first.
CMake Warning (dev) at CMakeLists.txt:18 (project):
  Policy CMP0048 is not set: project() command manages VERSION variables.
  Run "cmake --help-policy CMP0048" for policy details.  Use the cmake_policy
  command to set the policy and suppress this warning.

  The following variable(s) would be set to empty:

    CMAKE_PROJECT_VERSION
    CMAKE_PROJECT_VERSION_MAJOR
    CMAKE_PROJECT_VERSION_MINOR
    CMAKE_PROJECT_VERSION_PATCH
This warning is for project developers.  Use -Wno-dev to suppress it.

-- IPO enabled
-- The tbbbind_2_0 target will be configured using the HWLOC 2.1.0
-- Configuring done
-- Generating done
-- Build files have been written to: /mnt/data/starling/release
/mnt/data/starling/release /mnt/data/starling/scripts
[  1%] Built target tbbbind_2_0
[  2%] Built target bin_to_tsv
[  4%] Built target float_bin_to_int8
[  9%] Built target tbbmalloc
[ 11%] Built target fvecs_to_bvecs
[ 11%] Built target tsv_to_bin
[ 12%] Built target fvecs_to_bin
[ 14%] Built target simulate_aggregate_recall
[ 15%] Built target ivecs_to_bin
[ 28%] Built target diskann
[ 38%] Built target diskann_s
[ 58%] Built target tbb
[ 61%] Built target gen_random_slice
[ 61%] Built target int8_to_float
[ 62%] Built target uint8_to_float
[ 64%] Built target vector_analysis
[ 66%] Built target tbbmalloc_proxy
[ 68%] Built target parse_freq_file
[ 70%] Built target generate_pq
[ 72%] Built target int8_to_float_scale
[ 73%] Built target rand_data_gen
[ 74%] Built target compute_groundtruth
[ 77%] Built target uint32_to_uint8
[ 77%] Built target partition_data
[ 78%] Built target calculate_recall
[ 79%] Built target gen_range
[ 80%] Built target sq
[ 81%] Built target merge_shards
[ 83%] Built target build_memory_index
[ 85%] Built target partition_with_ram_budget
[ 87%] Built target create_disk_layout
[ 88%] Built target index_relayout
[ 90%] Built target search_memory_index
[ 91%] Built target build_disk_index
[ 92%] Built target search_memory_index_dynamic
[ 93%] Built target test_streaming_scenario
[ 95%] Built target range_search_disk_index
[ 96%] Built target search_disk_index
[ 98%] Built target test_insert_deletes_consolidate
[ 99%] Built target search_disk_index_save_freq
[100%] Built target partitioner
/mnt/data/starling/scripts
Mon 02 Dec 2024 02:12:56 AM CST
Using Beam Search
Searching... log file: bigann_1b_M32_R64_L50_B32/search/search_SQ0_K1_CACHE0_BW4_T1_MEML0_MEMK_MEM_USE_FREQ0_PS0_USE_RATIO1.0_GP_USE_FREQ{0}_GP_LOCK_NUMS0_GP_CUT4096.log
3
tcmalloc: large alloc 34000003072 bytes == 0x561815f82000 @  0x7fdcd07f2680 0x7fdcd0812ff4 0x561812ee635d 0x561812eeaff9 0x561812ce140a 0x561812cc823c 0x7fdcc8aca083 0x561812cc8a7e
Opened file : bigann_1b_M32_R64_L50_B32/_disk_beam_search.index
bigann_1b_M32_R64_L50_B32/search/search_SQ0_K1_CACHE0_BW4_T1_MEML0_MEMK_MEM_USE_FREQ0_PS0_USE_RATIO1.0_GP_USE_FREQ{0}_GP_LOCK_NUMS0_GP_CUT4096.log
     L   Beamwidth             QPS    Mean Latency    99.9 Latency        Mean IOs         CPU (s)      B4 Load In-Mem    After Load Cache   Peak Mem(MB)        Recall@1
     1           4          421.70         2354.86         5526.00           10.13           22.79               32487               32487          32488           13.85
     5           4          270.52         3661.87         7851.00           41.22           95.43               32487               32487          32489           60.86
    10           4          239.57         4133.85         8142.00           47.65          114.71               32487               32487          32489           74.09
    15           4          219.71         4509.21         8949.00           52.52          128.76               32487               32487          32489           79.80
    20           4          206.73         4793.15         8912.00           57.14          143.89               32487               32487          32489           83.75
    25           4          193.19         5130.33         9657.00           61.72          159.45               32487               32487          32489           86.61
    30           4          179.18         5533.48        10202.00           66.23          174.14               32487               32487          32489           88.44
    35           4          168.02         5902.02        10543.00           70.75          189.95               32487               32487          32489           90.03
    40           4          158.76         6247.53        10728.00           75.39          206.82               32487               32487          32489           91.29
    45           4          150.74         6580.98        11367.00           80.03          223.11               32487               32487          32489           92.22
    50           4          142.22         6976.30        11964.00           84.67          238.55               32487               32487          32490           93.11
    60           4          129.26         7677.99        12639.00           94.12          269.95               32487               32487          32490           94.35
    70           4          118.55         8365.18        13191.00          103.60          284.63               32487               32487          32490           95.04
    80           4          109.70         9041.91        14413.00          113.25          315.48               32487               32487          32490           96.01
    90           4          100.66         9856.84        14743.00          122.88          344.10               32487               32487          32490           96.54
   100           4           93.14        10655.95        16688.00          132.62          371.15               32487               32487          32490           97.07
   125           4           81.23        12221.21        17840.00          157.07          441.41               32487               32487          32490           97.78
   150           4           71.07        13971.92        19889.00          181.56          522.56               32487               32487          32490           98.29
   175           4           61.72        16095.72        22570.00          206.19          606.14               32487               32487          32490           98.66
   200           4           54.85        18101.57        26775.00          230.95          644.13               32487               32487          32492           98.91
   250           4           43.33        22932.05        32183.00          280.44          778.27               32487               32487          32492           99.25
   300           4           38.72        25665.60        34674.00          330.14          937.26               32487               32487          32492           99.40
+ source config_local.sh
++ source config_dataset.sh
++ dataset_index_10m
++ BASE_PATH=/mnt/data/data/index10m.fbin
++ QUERY_FILE=/mnt/data/data/query20k.fbin
++ GT_FILE=/mnt/data/data/data_query_index_gt100
++ PREFIX=index_10m
++ DATA_TYPE=float
++ DIST_FN=l2
++ B=1.6
++ K=1
++ DATA_DIM=512
++ DATA_N=10000000
++ R=64
++ BUILD_L=100
++ M=64
++ BUILD_T=32
++ USE_SQ=0
++ MEM_R=48
++ MEM_BUILD_L=128
++ MEM_ALPHA=1.2
++ MEM_RAND_SAMPLING_RATE=0.01
++ MEM_USE_FREQ=0
++ MEM_FREQ_USE_RATE=0.01
++ FREQ_QUERY_FILE=/mnt/data/data/query20k.fbin
++ FREQ_QUERY_CNT=0
++ FREQ_BM=4
++ FREQ_L=100
++ FREQ_T=16
++ FREQ_CACHE=0
++ FREQ_MEM_L=0
++ FREQ_MEM_TOPK=10
++ GP_TIMES=16
++ GP_T=32
++ GP_LOCK_NUMS=0
++ GP_USE_FREQ=0
++ GP_CUT=4096
++ BM_LIST=(4)
++ T_LIST=(1)
++ CACHE=0
++ MEM_L=0
++ USE_PAGE_SEARCH=1
++ PS_USE_RATIO=1.0
++ LS='30 40 50 75 100 125 150 175 200 250 300 350 400 450 500 600 700'
++ RS_LS=80
++ RS_ITER_KNN_TO_RANGE_SEARCH=1
++ KICKED_SIZE=0
++ RS_CUSTOM_ROUND=0
+ INDEX_PREFIX_PATH=index_10m_M64_R64_L100_B1.6/
+ MEM_SAMPLE_PATH=index_10m_M64_R64_L100_B1.6/SAMPLE_RATE_0.01/
+ MEM_INDEX_PATH=index_10m_M64_R64_L100_B1.6/MEM_R_48_L_128_ALPHA_1.2_MEM_USE_FREQ0_RANDOM_RATE0.01_FREQ_RATE0.01/
+ GP_PATH=index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/
+ FREQ_PATH=index_10m_M64_R64_L100_B1.6/FREQ/NQ_0_BM_4_L_100_T_16/
+ SUMMARY_FILE_PATH=../indices/summary.log
+ case $1 in
+ cmake -DCMAKE_BUILD_TYPE=Release .. -B ../release
CMake Warning (dev) at CMakeLists.txt:18 (project):
  Policy CMP0048 is not set: project() command manages VERSION variables.
  Run "cmake --help-policy CMP0048" for policy details.  Use the cmake_policy
  command to set the policy and suppress this warning.

  The following variable(s) would be set to empty:

    CMAKE_PROJECT_VERSION
    CMAKE_PROJECT_VERSION_MAJOR
    CMAKE_PROJECT_VERSION_MINOR
    CMAKE_PROJECT_VERSION_PATCH
This warning is for project developers.  Use -Wno-dev to suppress it.

-- IPO enabled
-- The tbbbind_2_0 target will be configured using the HWLOC 2.1.0
-- Configuring done
-- Generating done
-- Build files have been written to: /mnt/data/starling/release
+ EXE_PATH=../release
+ pushd ../release
/mnt/data/starling/release /mnt/data/starling/scripts
+ make -j
[  1%] Built target bin_to_tsv
[  5%] Built target float_bin_to_int8
[  8%] Built target tbbmalloc
[ 10%] Built target tbbbind_2_0
[ 10%] Built target fvecs_to_bin
[ 12%] Built target tsv_to_bin
[ 12%] Built target fvecs_to_bvecs
[ 15%] Built target simulate_aggregate_recall
[ 15%] Built target ivecs_to_bin
[ 27%] Built target diskann
[ 55%] Built target tbb
[ 58%] Built target diskann_s
[ 59%] Built target int8_to_float
[ 60%] Built target rand_data_gen
[ 62%] Built target gen_random_slice
[ 64%] Built target tbbmalloc_proxy
[ 66%] Built target parse_freq_file
[ 68%] Built target vector_analysis
[ 69%] Built target partition_data
[ 71%] Built target uint32_to_uint8
[ 73%] Built target create_disk_layout
[ 75%] Built target int8_to_float_scale
[ 77%] Built target partition_with_ram_budget
[ 79%] Built target merge_shards
[ 79%] Built target compute_groundtruth
[ 80%] Built target search_disk_index
[ 81%] Built target calculate_recall
[ 82%] Built target sq
[ 84%] Built target generate_pq
[ 85%] Built target uint8_to_float
[ 89%] Built target search_memory_index
[ 89%] Built target build_memory_index
[ 91%] Built target range_search_disk_index
[ 92%] Built target gen_range
[ 93%] Built target index_relayout
[ 94%] Built target build_disk_index
[ 96%] Built target search_memory_index_dynamic
[ 96%] Built target test_streaming_scenario
[ 98%] Built target test_insert_deletes_consolidate
[ 99%] Built target search_disk_index_save_freq
[100%] Built target partitioner
+ popd
/mnt/data/starling/scripts
+ mkdir -p ../indices
+ cd ../indices
+ date
Fri 20 Dec 2024 02:03:07 AM CST
+ case $2 in
+ check_dir_and_make_if_absent index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/
+ local dir=index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/
+ '[' -d index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/ ']'
+ mkdir -p index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/
+ OLD_INDEX_FILE=index_10m_M64_R64_L100_B1.6/_disk_beam_search.index
+ '[' '!' -f index_10m_M64_R64_L100_B1.6/_disk_beam_search.index ']'
+ GP_DATA_TYPE=float
+ '[' 0 -eq 1 ']'
+ GP_FILE_PATH=index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/_part.bin
+ echo 'Running graph partition... index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/_part.bin.log'
Running graph partition... index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/_part.bin.log
+ '[' 0 -eq 1 ']'
+ ../release/graph_partition/partitioner --index_file index_10m_M64_R64_L100_B1.6/_disk_beam_search.index --data_type float --gp_file index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/_part.bin -T 32 --ldg_times 16

real	5m38.140s
user	153m18.486s
sys	4m11.452s
+ echo 'Running relayout... index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/relayout.log'
Running relayout... index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/relayout.log
+ ../release/tests/utils/index_relayout index_10m_M64_R64_L100_B1.6/_disk_beam_search.index index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/_part.bin

real	1m36.837s
user	0m11.152s
sys	0m36.816s
+ '[' '!' -f index_10m_M64_R64_L100_B1.6/_disk_beam_search.index ']'
+ cp index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/_part_tmp.index index_10m_M64_R64_L100_B1.6/_disk.index
+ cp index_10m_M64_R64_L100_B1.6/GP_TIMES_16_LOCK_0_GP_USE_FREQ0_CUT4096/_part.bin index_10m_M64_R64_L100_B1.6/_partition.bin
